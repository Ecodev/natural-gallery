<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="UTF-8">

        <!-- Natural Gallery assets -->
        <link rel="stylesheet" href="/themes/natural.css">
        <link rel="stylesheet" href="/natural-gallery.full.css">
        <script src="/natural-gallery.full.js"></script>

    </head>

    <body>
        <div class="container">

            <svg version="1.1" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 100 100"  xml:space="preserve" style="display:none;">
                <g id="icon-select"><path d="M50,0C22.4,0,0,22.4,0,50c0,27.6,22.4,50,50,50c27.6,0,50-22.4,50-50C100,22.4,77.6,0,50,0z M40,75L15,50l7.1-7.1L40,60.8l37.9-37.9L85,30L40,75z"/></g>
                <g id="icon-next"><polygon points="88.126,24.216 50.036,62.306 11.947,24.216 0.355,35.809 50.036,85.49 99.718,35.809 		"/></g>
            </svg>

            <!-- Photoswipe template -->
            <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="pswp__bg"></div>
                <div class="pswp__scroll-wrap">
                    <div class="pswp__container">
                        <div class="pswp__item"></div>
                        <div class="pswp__item"></div>
                        <div class="pswp__item"></div>
                    </div>
                    <div class="pswp__ui pswp__ui--hidden">
                        <div class="pswp__top-bar">
                            <div class="pswp__counter"></div>
                            <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                            <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                            <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                            <div class="pswp__preloader">
                                <div class="pswp__preloader__icn">
                                    <div class="pswp__preloader__cut">
                                        <div class="pswp__preloader__donut"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                            <div class="pswp__share-tooltip"></div>
                        </div>
                        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
                        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>
                        <div class="pswp__caption">
                            <div class="pswp__caption__center"></div>
                        </div>
                    </div>
                </div>
            </div>

            <button id="selectVisible">Select visible</button>
            <button id="unselectAll">Unselect all</button>

            <br />
            <br />
            <!-- Gallery Wrapper  -->
            <div id="gallery" style="margin-bottom:100px;"></div>

        </div><!-- .container -->

        <script type="text/javascript">

            var rowHeight = 400;

            // Gallery options
            var options = {
                rowHeight: rowHeight,
                selectable: true,
                activable: true,
            };

            // Get reference of objects
            var galleryElement = document.getElementById('gallery');
            var photoswipeElement = document.getElementsByClassName('pswp')[0];

            // Listen custom events on DOM element
            galleryElement.addEventListener('activate', function(event) {
                console.log('activate (listen dom)', event.detail);
            });

            // When items are checked
            galleryElement.addEventListener('select', function(event) {
                console.log('select (listen dom)', event.detail);
            });

            // Watch pagination event on gallery DOM element should be done before gallery instantiation
            // If done after, the first notification will be missed.
            galleryElement.addEventListener('pagination', function(event) {
                console.log('pagination (listen dom)', event.detail)
            });

            // Create gallery
            var gallery = new NaturalGallery.NaturalGallery(galleryElement, photoswipeElement, options);

            // Select all visible images
            document.getElementById('selectVisible').addEventListener('click', function() {
                gallery.selectVisibleItems();
            });

            // Unselect all visible images
            document.getElementById('unselectAll').addEventListener('click', function() {
                gallery.unselectAllItems();
            });

            function getImages(url) {

                if (!url) {
                    url = '/images.json';
                }

                var xhr = new XMLHttpRequest();
                xhr.open('GET', url);
                xhr.send(null);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4 && xhr.status === 200) {

                        var items = JSON.parse(xhr.responseText).results.map(function(i) {
                            var item = {
                                thumbnailSrc: i.urls.small,
                                thumbnailWidth: rowHeight * i.width / i.height,
                                thumbnailHeight: rowHeight,
                                enlargedSrc: i.urls.full,
                                enlargedWidth: i.width,
                                enlargedHeight: i.height,
                                title: i.description ? i.description : i.user.name,
                            };
                            return item;
                        });

                        gallery.setItems(items);
                    }
                };
            }

            getImages();

        </script>

    </body>
</html>
